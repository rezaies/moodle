{"version":3,"sources":["../src/gateways_modal.js"],"names":["showPlaceholder","rootElement","Templates","renderForPromise","html","js","replaceNodeContents","querySelector","Selectors","regions","gatewaysContainer","process","amount","currency","Promise","all","Repository","getConfigForJs","paypalConfig","paypalScript","clientid","callExternalFunction","buttons","save","style","display","innerHTML","paypal","Buttons","createOrder","data","actions","order","create","purchase_units","currency_code","value","application_context","shipping_preference","brand_name","Truncate","truncate","brandname","length","stripTags","render","jsFile","callback","currentlyloaded","includes","script","document","createElement","readyState","onreadystatechange","onload","setAttribute","head","appendChild","push"],"mappings":"mfAuBA,OACA,OACA,OACA,O,u3DAQMA,CAAAA,CAAe,4CAAG,WAAMC,CAAN,4GACKC,WAAUC,gBAAV,CAA2B,qCAA3B,CAAkE,EAAlE,CADL,iBACbC,CADa,GACbA,IADa,CACPC,CADO,GACPA,EADO,CAEpBH,UAAUI,mBAAV,CAA8BL,CAAW,CAACM,aAAZ,CAA0BC,UAAUC,OAAV,CAAkBC,iBAA5C,CAA9B,CAA8FN,CAA9F,CAAoGC,CAApG,EAFoB,wCAAH,uD,CAKRM,CAAO,4CAAG,WAAMV,CAAN,CAAmBW,CAAnB,CAA2BC,CAA3B,8GAKTC,CAAAA,OAAO,CAACC,GAAR,CAAY,CAClBf,CAAe,CAACC,CAAD,CADG,CAElBe,CAAU,CAACC,cAAX,EAFkB,CAAZ,CALS,0BAIfC,CAJe,MAUbC,CAVa,mDAU6CD,CAAY,CAACE,QAV1D,sBAU+EP,CAV/E,EAYnBQ,CAAoB,CAACF,CAAD,CAAe,UAAM,CACrClB,CAAW,CAACM,aAAZ,CAA0BC,UAAUc,OAAV,CAAkBC,IAA5C,EAAkDC,KAAlD,CAAwDC,OAAxD,CAAkE,MAAlE,CACAxB,CAAW,CAACM,aAAZ,CAA0BC,UAAUC,OAAV,CAAkBC,iBAA5C,EAA+DgB,SAA/D,CAA2E,EAA3E,CACAC,MAAM,CAACC,OAAP,CAAe,CACXC,WAAW,CAAE,qBAASC,CAAT,CAAeC,CAAf,CAAwB,CAEjC,MAAOA,CAAAA,CAAO,CAACC,KAAR,CAAcC,MAAd,CAAqB,CACxBC,cAAc,CAAE,CAAC,CACbtB,MAAM,CAAE,CACJuB,aAAa,CAAEtB,CADX,CAEJuB,KAAK,CAAExB,CAFH,CADK,CAAD,CADQ,CAOxByB,mBAAmB,CAAE,CACjBC,mBAAmB,CAAE,aADJ,CAEjBC,UAAU,CAAEC,UAASC,QAAT,CAAkBvB,CAAY,CAACwB,SAA/B,CAA0C,CAACC,MAAM,CAAE,GAAT,CAAcC,SAAS,GAAvB,CAA1C,CAFK,CAPG,CAArB,CAYV,CAfU,CAAf,EAgBGC,MAhBH,CAgBUrC,UAAUC,OAAV,CAAkBC,iBAhB5B,CAiBH,CApBmB,CAApB,CAZmB,wCAAH,uD,aAmCpB,GAAMW,CAAAA,CAAoB,CAAG,SAACyB,CAAD,CAASC,CAAT,CAAsB,CAE/C,GAAI1B,CAAoB,CAAC2B,eAArB,CAAqCC,QAArC,CAA8CH,CAA9C,CAAJ,CAA2D,CACvDC,CAAQ,GACR,MACH,CAED,GAAMG,CAAAA,CAAM,CAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CAEA,GAAIF,CAAM,CAACG,UAAX,CAAuB,CACnBH,CAAM,CAACI,kBAAP,CAA4B,UAAW,CACnC,GAAuB,UAAnB,OAAKD,UAAL,EAAoD,QAAnB,OAAKA,UAA1C,CAAkE,CAC9D,KAAKC,kBAAL,CAA0B,IAA1B,CACAP,CAAQ,EACX,CACJ,CACJ,CAPD,IAOO,CACHG,CAAM,CAACK,MAAP,CAAgB,UAAW,CACvBR,CAAQ,EACX,CACJ,CAEDG,CAAM,CAACM,YAAP,CAAoB,KAApB,CAA2BV,CAA3B,EACAK,QAAQ,CAACM,IAAT,CAAcC,WAAd,CAA0BR,CAA1B,EAEA7B,CAAoB,CAAC2B,eAArB,CAAqCW,IAArC,CAA0Cb,CAA1C,CACH,CA1BD,CA4BAzB,CAAoB,CAAC2B,eAArB,CAAuC,E","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for PayPal content in the gateways modal.\n *\n * @module     pg_paypal/gateway_modal\n * @copyright  2020 Shamim Rezaie <shamim@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from './repository';\nimport Templates from 'core/templates';\nimport Selectors from './selectors';\nimport Truncate from 'core/truncate';\n\n/**\n * Renders a placeholder in the modal.\n *\n * @param rootElement\n * @returns {Promise<void>}\n */\nconst showPlaceholder = async(rootElement) => {\n    const {html, js} = await Templates.renderForPromise('pg_paypal/paypal_button_placeholder', {});\n    Templates.replaceNodeContents(rootElement.querySelector(Selectors.regions.gatewaysContainer), html, js);\n};\n\nexport const process = async(rootElement, amount, currency, component, componentid) => {\n\n    const [\n        ,\n        paypalConfig,\n    ] = await Promise.all([\n        showPlaceholder(rootElement),\n        Repository.getConfigForJs(),\n    ]);\n\n    const paypalScript = `https://www.paypal.com/sdk/js?client-id=${paypalConfig.clientid}&currency=${currency}`;\n\n    callExternalFunction(paypalScript, () => {\n        rootElement.querySelector(Selectors.buttons.save).style.display = 'none';\n        rootElement.querySelector(Selectors.regions.gatewaysContainer).innerHTML = '';\n        paypal.Buttons({ // eslint-disable-line\n            createOrder: function(data, actions) {\n                // This function sets up the details of the transaction, including the amount and line item details.\n                return actions.order.create({\n                    purchase_units: [{ // eslint-disable-line\n                        amount: {\n                            currency_code: currency, // eslint-disable-line\n                            value: amount\n                        }\n                    }],\n                    application_context: { // eslint-disable-line\n                        shipping_preference: 'NO_SHIPPING', // eslint-disable-line\n                        brand_name: Truncate.truncate(paypalConfig.brandname, {length: 127, stripTags: true}), // eslint-disable-line\n                    },\n                });\n            },\n        }).render(Selectors.regions.gatewaysContainer);\n    });\n};\n\nconst callExternalFunction = (jsFile, callback) => {\n    // Check to see if this file has already been loaded. If so just go straight to the callback.\n    if (callExternalFunction.currentlyloaded.includes(jsFile)) {\n        callback();\n        return;\n    }\n\n    const script = document.createElement('script');\n\n    if (script.readyState) {\n        script.onreadystatechange = function() {\n            if (this.readyState == 'complete' || this.readyState == 'loaded') {\n                this.onreadystatechange = null;\n                callback();\n            }\n        };\n    } else {\n        script.onload = function() {\n            callback();\n        };\n    }\n\n    script.setAttribute('src', jsFile);\n    document.head.appendChild(script);\n\n    callExternalFunction.currentlyloaded.push(jsFile);\n};\n\ncallExternalFunction.currentlyloaded = [];\n"],"file":"gateways_modal.min.js"}